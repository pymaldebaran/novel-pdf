% !TeX TS-program = lualatex
% !TeX encoding = UTF-8

% Copyright 2024 Pierre-Yves Martin.
% This file may be distributed and/or modified under the
% conditions of the LaTeX Project Public License, version 1.3c.
% License URL:  https://www.latex-project.org/lppl/lppl-1-3c/

% EXAMPLE OF NOVEL DOCUMENT CLASS, using mostly default layout.
% IF YOU COMPILE THIS DOCUMENT: Be sure that this file, and its generated PDF,
%   have read/write permissions for any user. If they don't, then
%   compile will fail at the point where files are written.

% This is a pandoc/quarto template document (generating LaTeX document) and
% it respect the pandoc template syntax.
% See: https://pandoc.org/chunkedhtml-demo/6.1-template-syntax.html

% This file is partially based on the quarto LaTeX
% See: template https://github.com/quarto-dev/quarto-cli/blob/main/src/resources/formats/pdf/pandoc/template.tex

$-- class_options is a metadata generated by the novel_class_options filter according to various metadata values
\documentclass[$for(class_options)$$class_options$$sep$,$endfor$]{novel}

%%% GENERAL FONTS:
% Choose only Open Type or TrueType fonts, not the ancient Type 1 (PostScript) or Metafonts.
% The font you choose does not have to be part of any TeX package, because you do not need
% any *.sty file or TeX metrics. All of that is built into the font itself.
% This is thanks to LuaLaTeX and the built-in fontspec package.
%
% You do not write \usepackage{fontname}
% or \RequirePackage{fontname}
% or \setmainfont{fontname}.
% If you do that, then a warning or error will result, and in any case the font you get won't be the one you were expecting.
\SetParentFont[%
$fonts.parent.features$
]{$fonts.parent.name$}
\SetFontSize{$fonts.parent.size$}

%%% SPECIFIC FONTS
\SetDecoFont{$fonts.deco.name$}
\setsansfont{$fonts.sans.name$}
\setmonofont[Scale=$fonts.mono.scale$]{$fonts.mono.name$}
\setmathfont{$fonts.math.name$}

%%% PAGE LAYOUT
\SetLinesPerPage{$page_layout.lines_per_page$}
\setlength{\parindent}{$page_layout.parindent$}
\setlength{\parskip}{$page_layout.parskip$}

$-- draft_watermark is a metadata generated by the novel_class_options filter according to various metadata values
$if(draft_watermark)$
% Draft watermarking
% See: https://texblog.org/2012/02/17/watermarks-draft-review-approved-confidential/
\usepackage[firstpage]{draftwatermark}
$endif$

% Novel class config
\SetChapterStartHeight{$chapters.header_height$}  % https://ctan.math.illinois.edu/macros/luatex/latex/novel/doc/novel-documentation.html#h5.1.2.2
\SetMarkerStyle{number}  % https://ctan.math.illinois.edu/macros/luatex/latex/novel/doc/novel-documentation.html#h6.4.1
$if(scenebreaks.indent)$
\SetScenebreakIndent{true}
$endif$

% Quarto/pandoc config
$-- taken from https://github.com/quarto-dev/quarto-cli/blob/main/src/resources/formats/pdf/pandoc/latex.template
$if(strikeout)$
$-- also used for underline
\usepackage{luacolor}
\usepackage[soul]{lua-ul}
$endif$

$-- taken from https://github.com/quarto-dev/quarto-cli/blob/main/src/resources/formats/pdf/pandoc/template.tex
$if(links-as-notes)$
% Make links footnotes instead of hotlinks:
\DeclareRobustCommand{\href}[2]{#2\footnote{\url{#1}}}
$endif$

$-- taken from https://github.com/quarto-dev/quarto-cli/blob/main/src/resources/formats/pdf/pandoc/pandoc.tex
$tightlist.tex()$

% Metadata informations
\SetTitle{$title$}
\SetSubtitle{$subtitle$}
\SetAuthor{$author$}
\SetPDFX[CGATSTR001]{X-1a:2001}

\begin{document}

\frontmatter

% i. half_title page:
\thispagestyle{empty}
$if(front_matter.half_title)$
$front_matter.half_title$
$else$
\vspace*{6\nbs}
\hfill\charscale[2.4]{\textbf{\theTitle}}\par
$endif$
\clearpage

% ii. Blank page:
\thispagestyle{empty}
\null
\clearpage

% iii. Full Title page:
\thispagestyle{empty}
\vspace*{5\nbs}
\begin{center}
$if(front_matter.full_title)$
$front_matter.full_title$
$else$
\charscale[3.6]{\textbf{\theTitle}}\par
$endif$
\vspace{1.5\nbs}
\charscale[1.6]{\theSubtitle}\par
\vspace{4\nbs}
\ChapterDeco[6]{\decoglyph{n9548}}
\vspace{4\nbs}
{\addfontfeature{Scale=3}\theAuthor}
\vfill
{\addfontfeature{Scale=1.25} $publisher.name$\\
$publisher.location$}\par

\end{center}
\clearpage


% iv. Copyright page:
\thispagestyle{empty}
\begin{center}
\itshape{
\null
\vfill
\textsc{\theTitle}\par
\par

$legal_rights$\par
\vspace{1\nbs}
$if(fiction_mention)$
$fiction_mention$\par
$else$
This is a work of fiction.\\
All persons and events are\\
from the author's imagination.\\
Resemblance to any real person,\\
living or dead, is coincidental.\par
$endif$
\vspace{1\nbs}
ISBN $isbn$\par % Whatever it is. No barcode, just number.
\vspace{1\nbs}

$publisher.full_mention$
} % end itshape
\end{center}
\clearpage

$body$

\end{document}
